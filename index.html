
<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta content="IE=edge,chrome=1" http-equiv="X-UA-Compatible">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <title>Voting Integrations (VI) Documentation</title>

    <link href="https://fonts.googleapis.com/css?family=Lato:400,400i,700,700i" rel="stylesheet">
    <style media="screen">
      .highlight table td { padding: 5px; }
.highlight table pre { margin: 0; }
.highlight .gh {
  color: #999999;
}
.highlight .sr {
  color: #f6aa11;
}
.highlight .go {
  color: #888888;
}
.highlight .gp {
  color: #555555;
}
.highlight .gs {
}
.highlight .gu {
  color: #aaaaaa;
}
.highlight .nb {
  color: #f6aa11;
}
.highlight .cm {
  color: #75715e;
}
.highlight .cp {
  color: #75715e;
}
.highlight .c1 {
  color: #75715e;
}
.highlight .cs {
  color: #75715e;
}
.highlight .c, .highlight .ch, .highlight .cd, .highlight .cpf {
  color: #75715e;
}
.highlight .err {
  color: #960050;
}
.highlight .gr {
  color: #960050;
}
.highlight .gt {
  color: #960050;
}
.highlight .gd {
  color: #49483e;
}
.highlight .gi {
  color: #49483e;
}
.highlight .ge {
  color: #49483e;
}
.highlight .kc {
  color: #66d9ef;
}
.highlight .kd {
  color: #66d9ef;
}
.highlight .kr {
  color: #66d9ef;
}
.highlight .no {
  color: #66d9ef;
}
.highlight .kt {
  color: #66d9ef;
}
.highlight .mf {
  color: #ae81ff;
}
.highlight .mh {
  color: #ae81ff;
}
.highlight .il {
  color: #ae81ff;
}
.highlight .mi {
  color: #ae81ff;
}
.highlight .mo {
  color: #ae81ff;
}
.highlight .m, .highlight .mb, .highlight .mx {
  color: #ae81ff;
}
.highlight .sc {
  color: #ae81ff;
}
.highlight .se {
  color: #ae81ff;
}
.highlight .ss {
  color: #ae81ff;
}
.highlight .sd {
  color: #e6db74;
}
.highlight .s2 {
  color: #e6db74;
}
.highlight .sb {
  color: #e6db74;
}
.highlight .sh {
  color: #e6db74;
}
.highlight .si {
  color: #e6db74;
}
.highlight .sx {
  color: #e6db74;
}
.highlight .s1 {
  color: #e6db74;
}
.highlight .s, .highlight .sa, .highlight .dl {
  color: #e6db74;
}
.highlight .na {
  color: #a6e22e;
}
.highlight .nc {
  color: #a6e22e;
}
.highlight .nd {
  color: #a6e22e;
}
.highlight .ne {
  color: #a6e22e;
}
.highlight .nf, .highlight .fm {
  color: #a6e22e;
}
.highlight .vc {
  color: #ffffff;
}
.highlight .nn {
  color: #ffffff;
}
.highlight .ni {
  color: #ffffff;
}
.highlight .bp {
  color: #ffffff;
}
.highlight .vg {
  color: #ffffff;
}
.highlight .vi {
  color: #ffffff;
}
.highlight .nv, .highlight .vm {
  color: #ffffff;
}
.highlight .w {
  color: #ffffff;
}
.highlight {
  color: #ffffff;
}
.highlight .n, .highlight .py, .highlight .nx {
  color: #ffffff;
}
.highlight .nl {
  color: #f92672;
}
.highlight .ow {
  color: #f92672;
}
.highlight .nt {
  color: #f92672;
}
.highlight .k, .highlight .kv {
  color: #f92672;
}
.highlight .kn {
  color: #f92672;
}
.highlight .kp {
  color: #f92672;
}
.highlight .o {
  color: #f92672;
}
    </style>
    <style media="print">
      * {
        -webkit-transition:none!important;
        transition:none!important;
      }
      .highlight table td { padding: 5px; }
.highlight table pre { margin: 0; }
.highlight, .highlight .w {
  color: #586e75;
}
.highlight .err {
  color: #002b36;
  background-color: #dc322f;
}
.highlight .c, .highlight .ch, .highlight .cd, .highlight .cm, .highlight .cpf, .highlight .c1, .highlight .cs {
  color: #657b83;
}
.highlight .cp {
  color: #b58900;
}
.highlight .nt {
  color: #b58900;
}
.highlight .o, .highlight .ow {
  color: #93a1a1;
}
.highlight .p, .highlight .pi {
  color: #93a1a1;
}
.highlight .gi {
  color: #859900;
}
.highlight .gd {
  color: #dc322f;
}
.highlight .gh {
  color: #268bd2;
  background-color: #002b36;
  font-weight: bold;
}
.highlight .k, .highlight .kn, .highlight .kp, .highlight .kr, .highlight .kv {
  color: #6c71c4;
}
.highlight .kc {
  color: #cb4b16;
}
.highlight .kt {
  color: #cb4b16;
}
.highlight .kd {
  color: #cb4b16;
}
.highlight .s, .highlight .sb, .highlight .sc, .highlight .dl, .highlight .sd, .highlight .s2, .highlight .sh, .highlight .sx, .highlight .s1 {
  color: #859900;
}
.highlight .sa {
  color: #6c71c4;
}
.highlight .sr {
  color: #2aa198;
}
.highlight .si {
  color: #d33682;
}
.highlight .se {
  color: #d33682;
}
.highlight .nn {
  color: #b58900;
}
.highlight .nc {
  color: #b58900;
}
.highlight .no {
  color: #b58900;
}
.highlight .na {
  color: #268bd2;
}
.highlight .m, .highlight .mb, .highlight .mf, .highlight .mh, .highlight .mi, .highlight .il, .highlight .mo, .highlight .mx {
  color: #859900;
}
.highlight .ss {
  color: #859900;
}
    </style>
    <link href="stylesheets/screen-082e5882.css" rel="stylesheet" media="screen" />
    <link href="stylesheets/print-d0fccdda.css" rel="stylesheet" media="print" />
      <script src="javascripts/all-e033bdd3.js"></script>

  </head>

  <body class="index" data-languages="[&quot;ruby&quot;,&quot;python&quot;,&quot;php&quot;]">
    <a href="#" id="nav-button">
      <span>
        NAV
        <img src="images/navbar-cad8cdcb.png" alt="" />
      </span>
    </a>
    <div class="toc-wrapper">
      <img src="images/logo-567d73fb.png" class="logo" alt="" />
        <div class="lang-selector">
              <a href="#" data-language-name="ruby">ruby</a>
              <a href="#" data-language-name="python">python</a>
              <a href="#" data-language-name="php">php</a>
        </div>
        <div class="search">
          <input type="text" class="search" id="input-search" placeholder="Search">
        </div>
        <ul class="search-results"></ul>
      <ul id="toc" class="toc-list-h1">
          <li>
            <a href="#introduction" class="toc-h1 toc-link" data-title="Introduction">Introduction</a>
          </li>
          <li>
            <a href="#current-version-2" class="toc-h1 toc-link" data-title="Current (Version 2)">Current (Version 2)</a>
              <ul class="toc-list-h2">
                  <li>
                    <a href="#http-request" class="toc-h2 toc-link" data-title="HTTP Request">HTTP Request</a>
                  </li>
                  <li>
                    <a href="#query-parameters" class="toc-h2 toc-link" data-title="Query Parameters">Query Parameters</a>
                  </li>
              </ul>
          </li>
          <li>
            <a href="#legacy-version-1" class="toc-h1 toc-link" data-title="Legacy (Version 1)">Legacy (Version 1)</a>
              <ul class="toc-list-h2">
                  <li>
                    <a href="#http-request-2" class="toc-h2 toc-link" data-title="HTTP Request">HTTP Request</a>
                  </li>
                  <li>
                    <a href="#query-parameters-2" class="toc-h2 toc-link" data-title="Query Parameters">Query Parameters</a>
                  </li>
              </ul>
          </li>
          <li>
            <a href="#errors" class="toc-h1 toc-link" data-title="Errors">Errors</a>
          </li>
          <li>
            <a href="#voter-status" class="toc-h1 toc-link" data-title="Voter Status">Voter Status</a>
              <ul class="toc-list-h2">
                  <li>
                    <a href="#http-request" class="toc-h2 toc-link" data-title="HTTP Request">HTTP Request</a>
                  </li>
              </ul>
          </li>
      </ul>
        <ul class="toc-footer">
            <li>Back to <a href='https://electionbuddy.com'>electionbuddy.com</a></li>
        </ul>
    </div>
    <div class="page-wrapper">
      <div class="dark-box"></div>
      <div class="content">
        <h1 id='introduction'>Introduction</h1>
<p>Welcome to the Voting Integrations (VI) documentation for ElectionBuddy (electionbuddy.com). We continue to maintain both our legacy (version 1, or V1) integrations, as well our in-development (version 2, or V2) voting integrations to allow your voters to authenticate with ElectionBuddy within your own member or customer portal or customer relationship management (CRM) software.</p>
<h1 id='current-version-2'>Current (Version 2)</h1>
<blockquote>
<p>The function/method below will return templated HTML in the form of a <code>&lt;ul&gt;</code> list of elections that the current voter is eligible to vote in. It will search all <code>Elections</code> belonging to an <code>Organization</code>, <strong>including</strong> sister <code>Organization</code>s (i.e. sharing the same <code>BillingAccount</code>).</p>
</blockquote>
<div class="highlight"><pre class="highlight ruby tab-ruby"><code><span class="nb">require</span> <span class="s1">'addressable/uri'</span>
<span class="nb">require</span> <span class="s1">'base64'</span>
<span class="nb">require</span> <span class="s1">'openssl'</span>
<span class="nb">require</span> <span class="s1">'faraday'</span>

<span class="c1">#####</span>

<span class="c1"># Parameters:</span>
<span class="c1"># `oid` - your Organization's ID (available from https://secure.electionbuddy.com/organizations)</span>
<span class="c1"># `exp` - Unix epoch timestamp (we validate this to within +/- 5 minutes of current time)</span>
<span class="c1"># `identifier` - the Voter's identifier for which to search for eligible elections</span>
<span class="c1"># `secret_token` - your Organizations Secret Token (https://secure.electionbuddy.com/organizations)</span>
<span class="c1"># `signature` - a Base64, HMAC-SHA256 signature of the above parameters in order (oid, exp, identifier)</span>
<span class="c1">#</span>
<span class="c1"># Returns HTML:</span>
<span class="c1">#</span>

<span class="c1">#####</span>

<span class="k">def</span> <span class="nf">get_election_list</span><span class="p">(</span><span class="n">oid</span><span class="p">,</span> <span class="n">exp</span><span class="p">,</span> <span class="n">identifier</span><span class="p">,</span> <span class="n">secret_token</span><span class="p">)</span>
  <span class="n">url</span> <span class="o">=</span> <span class="s1">'https://secure.electionbuddy.com/integrations/v2/elections'</span>

  <span class="n">query_values</span> <span class="o">=</span> <span class="p">{</span>
    <span class="ss">exp: </span><span class="no">Time</span><span class="p">.</span><span class="nf">now</span><span class="p">.</span><span class="nf">to_i</span><span class="p">,</span>
    <span class="ss">identifier: </span><span class="n">identifier</span><span class="p">,</span>
    <span class="ss">oid: </span><span class="n">oid</span>
  <span class="p">}</span>

  <span class="n">uri</span> <span class="o">=</span> <span class="no">Addressable</span><span class="o">::</span><span class="no">URI</span><span class="p">.</span><span class="nf">parse</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
  <span class="n">uri</span><span class="p">.</span><span class="nf">query_values</span> <span class="o">=</span> <span class="n">query_values</span>
  <span class="n">message</span> <span class="o">=</span> <span class="n">uri</span><span class="p">.</span><span class="nf">query</span>
  <span class="n">signature</span> <span class="o">=</span> <span class="no">Base64</span><span class="p">.</span><span class="nf">urlsafe_encode64</span><span class="p">(</span>
    <span class="no">OpenSSL</span><span class="o">::</span><span class="no">HMAC</span><span class="p">.</span><span class="nf">digest</span><span class="p">(</span><span class="s1">'sha256'</span><span class="p">,</span> <span class="n">secret_token</span><span class="p">,</span> <span class="n">message</span><span class="p">)</span>
  <span class="p">)</span>
  <span class="n">uri</span><span class="p">.</span><span class="nf">query_values</span> <span class="o">=</span> <span class="n">query_values</span><span class="p">.</span><span class="nf">merge</span><span class="p">(</span><span class="ss">signature: </span><span class="n">signature</span><span class="p">)</span>
  <span class="no">Faraday</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="n">uri</span><span class="p">).</span><span class="nf">body</span>
<span class="k">end</span>
</code></pre></div><div class="highlight"><pre class="highlight python tab-python"><code><span class="kn">import</span> <span class="nn">base64</span>
<span class="kn">import</span> <span class="nn">hashlib</span>
<span class="kn">import</span> <span class="nn">hmac</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">import</span> <span class="nn">requests</span>
<span class="kn">from</span> <span class="nn">urllib.parse</span> <span class="kn">import</span> <span class="n">urlparse</span><span class="p">,</span> <span class="n">urlencode</span>

<span class="c1">#####
</span>
<span class="c1"># Parameters:
# `oid` - your Organization's ID (available from https://secure.electionbuddy.com/organizations)
# `exp` - Unix epoch timestamp (we validate this to within +/- 5 minutes of current time)
# `identifier` - the Voter's identifier for which to search for eligible elections
# `secret_token` - your Organizations Secret Token (https://secure.electionbuddy.com/organizations)
# `signature` - a Base64, HMAC-SHA256 signature of the above parameters in order (oid, exp, identifier)
#
# Returns HTML:
#
</span>
<span class="c1">#####
</span>
<span class="k">def</span> <span class="nf">get_election_list</span><span class="p">(</span><span class="n">oid</span><span class="p">,</span> <span class="n">exp</span><span class="p">,</span> <span class="n">identifier</span><span class="p">,</span> <span class="n">secret_token</span><span class="p">):</span>
  <span class="n">url</span> <span class="o">=</span> <span class="s">'https://secure.electionbuddy.com/integrations/v2/elections'</span>

  <span class="n">query_values</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s">'exp'</span> <span class="p">:</span> <span class="nb">int</span><span class="p">(</span><span class="n">time</span><span class="p">.</span><span class="n">time</span><span class="p">()),</span>
    <span class="s">'identifier'</span> <span class="p">:</span> <span class="n">identifier</span><span class="p">,</span>
    <span class="s">'oid'</span> <span class="p">:</span> <span class="n">oid</span>
  <span class="p">}</span>

  <span class="n">message</span> <span class="o">=</span> <span class="n">urlencode</span><span class="p">(</span><span class="n">query_values</span><span class="p">)</span>
  <span class="n">signature</span> <span class="o">=</span> <span class="n">base64</span><span class="p">.</span><span class="n">urlsafe_b64encode</span><span class="p">(</span>
    <span class="n">hmac</span><span class="p">.</span><span class="n">new</span><span class="p">(</span><span class="n">secret_token</span><span class="p">.</span><span class="n">encode</span><span class="p">(),</span> <span class="n">message</span><span class="p">.</span><span class="n">encode</span><span class="p">(),</span> <span class="n">hashlib</span><span class="p">.</span><span class="n">sha256</span><span class="p">).</span><span class="n">digest</span><span class="p">()</span>
  <span class="p">).</span><span class="n">decode</span><span class="p">()</span>
  <span class="n">query_values</span><span class="p">[</span><span class="s">'signature'</span><span class="p">]</span> <span class="o">=</span> <span class="n">signature</span>
  <span class="n">message</span> <span class="o">=</span> <span class="n">urlencode</span><span class="p">(</span><span class="n">query_values</span><span class="p">)</span>
  <span class="n">uri</span> <span class="o">=</span> <span class="n">url</span> <span class="o">+</span> <span class="s">'?'</span> <span class="o">+</span> <span class="n">message</span>
  <span class="k">return</span> <span class="n">requests</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="n">uri</span><span class="p">).</span><span class="n">content</span>
</code></pre></div><div class="highlight"><pre class="highlight php tab-php"><code><span class="cp">&lt;?</span>

<span class="c1">#####</span>

<span class="c1"># Parameters:</span>
<span class="c1"># `oid` - your Organization's ID (available from https://secure.electionbuddy.com/organizations)</span>
<span class="c1"># `exp` - Unix epoch timestamp (we validate this to within +/- 5 minutes of current time)</span>
<span class="c1"># `identifier` - the Voter's identifier for which to search for eligible elections</span>
<span class="c1"># `secret_token` - your Organizations Secret Token (https://secure.electionbuddy.com/organizations)</span>
<span class="c1"># `signature` - a Base64, HMAC-SHA256 signature of the above parameters in order (oid, exp, identifier)</span>
<span class="c1">#</span>
<span class="c1"># Returns HTML:</span>
<span class="c1">#</span>

<span class="c1">#####</span>

<span class="k">function</span> <span class="n">get_election_list</span><span class="p">(</span><span class="nv">$oid</span><span class="p">,</span> <span class="nv">$exp</span><span class="p">,</span> <span class="nv">$identifier</span><span class="p">,</span> <span class="nv">$secret_token</span><span class="p">)</span> <span class="p">{</span>
  <span class="nv">$url</span> <span class="o">=</span> <span class="s1">'https://secure.electionbuddy.com/integrations/v2/elections'</span><span class="p">;</span>

  <span class="nv">$query_values</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span>
    <span class="s1">'exp'</span> <span class="o">=&gt;</span> <span class="nb">time</span><span class="p">(),</span>
    <span class="s1">'identifier'</span> <span class="o">=&gt;</span> <span class="nv">$identifier</span><span class="p">,</span>
    <span class="s1">'oid'</span> <span class="o">=&gt;</span> <span class="nv">$oid</span>
  <span class="p">);</span>

  <span class="nv">$message</span> <span class="o">=</span> <span class="nb">http_build_query</span><span class="p">(</span><span class="nv">$query_values</span><span class="p">);</span>
  <span class="nv">$signature</span> <span class="o">=</span> <span class="nb">strtr</span><span class="p">(</span><span class="nb">base64_encode</span><span class="p">(</span><span class="nb">hash_hmac</span><span class="p">(</span><span class="s1">'sha256'</span><span class="p">,</span> <span class="nv">$message</span><span class="p">,</span> <span class="nv">$secret_token</span><span class="p">,</span> <span class="kc">true</span><span class="p">)),</span> <span class="s1">'+/'</span><span class="p">,</span> <span class="s1">'-_'</span><span class="p">);</span>
  <span class="nv">$query_values</span><span class="p">[</span><span class="s1">'signature'</span><span class="p">]</span> <span class="o">=</span> <span class="nv">$signature</span><span class="p">;</span>
  <span class="nv">$message</span> <span class="o">=</span> <span class="nb">http_build_query</span><span class="p">(</span><span class="nv">$query_values</span><span class="p">);</span>
  <span class="nv">$uri</span> <span class="o">=</span> <span class="nv">$url</span> <span class="mf">.</span> <span class="s1">'?'</span> <span class="mf">.</span> <span class="nv">$message</span><span class="p">;</span>

  <span class="k">return</span> <span class="nb">file_get_contents</span><span class="p">(</span><span class="nv">$uri</span><span class="p">);</span>

<span class="p">}</span>
<span class="cp">?&gt;</span>
</code></pre></div>
<p>This endpoint authenticates a voting request for a particular organization. If the signature is valid and the voter (identified by <code>identifier</code>) has yet to vote in any elections they are eligible to vote in, we will return an HTML list (<code>&lt;ul&gt;</code>) with links to vote.</p>
<h3 id='http-request'>HTTP Request</h3>
<p><code>GET https://secure.electionbuddy.com/integrations/v2/elections?{parameters}</code></p>
<h3 id='query-parameters'>Query Parameters</h3>
<table><thead>
<tr>
<th>Parameter</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>exp</td>
<td>Request expiration date, in <a href="https://www.epochconverter.com/">Unix Epoch Time</a>. This time must be +/- 5 minutes from the time the request is received. If <code>exp</code> is older than 5 minutes, the voter will be directed to a &quot;Link Expired&quot; page.</td>
</tr>
<tr>
<td>identifier</td>
<td>Member ID: A unique identifier for the member who is voting, such as an email address, or the <code>identifier</code> when you uploaded your voter details for an election.</td>
</tr>
<tr>
<td>oid</td>
<td>Your Organization&#39;s ID (available from https://secure.electionbuddy.com/organizations)</td>
</tr>
<tr>
<td>signature</td>
<td>Generated signature using <code>secret_token</code>. See below.</td>
</tr>
</tbody></table>

<ul>
<li>All requests must be signed by <code>signature</code> <strong>appended</strong> (as the last parameter) to the query string, and generated from the formatted query string consisting of <code>oid</code>, <code>exp</code>, and <code>identifier</code>.</li>
<li>Signatures must be generated using HMAC-SHA256 using the <code>secret_token</code> for your Organization in your <a href="https://secure.electionbuddy.com/organizations">ElectionBuddy account</a>.</li>
<li>All other parameters should appear <strong>alphabetically</strong> in the query string (i.e. <code>exp</code>, <code>identifier</code>, <code>oid</code>).</li>
</ul>

<aside class="notice">
Remember - the query parameters must occur <strong>in order (alphabetically)</strong> as shown above, with the signature <strong>appended</strong> as the last parameter of the query string.
</aside>
<h1 id='legacy-version-1'>Legacy (Version 1)</h1>
<blockquote>
<p>The function/method below will generate a signed anchor <code>&lt;a&gt;</code> element that you can use on your organization&#39;s internal dashboard (i.e. after a member/voter logs in). You can style it as you wish to match your organization&#39;s design or theme. You&#39;ll need to pass in <code>eid</code>, <code>exp</code>, <code>mid</code>, and <code>signature</code> as appropriate.</p>
</blockquote>
<div class="highlight"><pre class="highlight ruby tab-ruby"><code><span class="nb">require</span> <span class="s1">'addressable/uri'</span>
<span class="nb">require</span> <span class="s1">'base64'</span>
<span class="nb">require</span> <span class="s1">'openssl'</span>

<span class="c1">##### Example values:</span>

<span class="c1"># eid = '12'</span>
<span class="c1"># mid = 'jane@example.com'</span>
<span class="c1"># secret_key = 'N+vlebJgl/Lkxtu2b4hOe+JUTpVm5arWGJbQ6U7BOFs='</span>
<span class="c1"># (Contact support to obtain `secret_key`)</span>

<span class="c1">#####</span>

<span class="k">def</span> <span class="nf">generate_vote_anchor</span><span class="p">(</span><span class="n">secret_key</span><span class="p">,</span> <span class="n">eid</span><span class="p">,</span> <span class="n">mid</span><span class="p">)</span>
  <span class="n">url</span> <span class="o">=</span> <span class="s1">'https://secure.electionbuddy.com/integrations/v1/sso'</span>

  <span class="n">query_values</span> <span class="o">=</span> <span class="p">{</span>
    <span class="ss">eid: </span><span class="n">eid</span><span class="p">,</span>
    <span class="ss">exp: </span><span class="no">Time</span><span class="p">.</span><span class="nf">now</span><span class="p">.</span><span class="nf">to_i</span><span class="p">,</span>
    <span class="ss">mid: </span><span class="n">mid</span>
  <span class="p">}</span>

  <span class="n">uri</span> <span class="o">=</span> <span class="no">Addressable</span><span class="o">::</span><span class="no">URI</span><span class="p">.</span><span class="nf">parse</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
  <span class="n">uri</span><span class="p">.</span><span class="nf">query_values</span> <span class="o">=</span> <span class="n">query_values</span>
  <span class="n">message</span> <span class="o">=</span> <span class="n">uri</span><span class="p">.</span><span class="nf">query</span>
  <span class="n">signature</span> <span class="o">=</span> <span class="no">Base64</span><span class="p">.</span><span class="nf">urlsafe_encode64</span><span class="p">(</span>
    <span class="no">OpenSSL</span><span class="o">::</span><span class="no">HMAC</span><span class="p">.</span><span class="nf">digest</span><span class="p">(</span><span class="s1">'sha256'</span><span class="p">,</span> <span class="n">secret_key</span><span class="p">,</span> <span class="n">message</span><span class="p">)</span>
  <span class="p">)</span>
  <span class="n">uri</span><span class="p">.</span><span class="nf">query_values</span> <span class="o">=</span> <span class="n">query_values</span><span class="p">.</span><span class="nf">merge</span><span class="p">(</span><span class="ss">signature: </span><span class="n">signature</span><span class="p">)</span>
  <span class="s2">"&lt;a href='</span><span class="si">#{</span><span class="n">uri</span><span class="si">}</span><span class="s2">' class='electionbuddy-vote-button'&gt;Vote now&lt;/a&gt;"</span>
<span class="k">end</span>
</code></pre></div><div class="highlight"><pre class="highlight python tab-python"><code><span class="kn">import</span> <span class="nn">base64</span>
<span class="kn">import</span> <span class="nn">hashlib</span>
<span class="kn">import</span> <span class="nn">hmac</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">from</span> <span class="nn">urllib.parse</span> <span class="kn">import</span> <span class="n">urlparse</span><span class="p">,</span> <span class="n">urlencode</span>

<span class="c1">##### Example values:
</span>
<span class="c1"># eid = '12'
# mid = 'jane@example.com'
# secret_key = 'N+vlebJgl/Lkxtu2b4hOe+JUTpVm5arWGJbQ6U7BOFs='
# (Contact support to obtain `secret_key`)
</span>
<span class="c1">#####
</span>
<span class="k">def</span> <span class="nf">generate_vote_anchor</span><span class="p">(</span><span class="n">secret_key</span><span class="p">,</span> <span class="n">eid</span><span class="p">,</span> <span class="n">mid</span><span class="p">):</span>
  <span class="n">url</span> <span class="o">=</span> <span class="s">'https://secure.electionbuddy.com/integrations/v1/sso'</span>

  <span class="n">query_values</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s">'eid'</span> <span class="p">:</span> <span class="n">eid</span><span class="p">,</span>
    <span class="s">'exp'</span> <span class="p">:</span> <span class="nb">int</span><span class="p">(</span><span class="n">time</span><span class="p">.</span><span class="n">time</span><span class="p">()),</span>
    <span class="s">'mid'</span> <span class="p">:</span> <span class="n">mid</span>
  <span class="p">}</span>

  <span class="n">message</span> <span class="o">=</span> <span class="n">urlencode</span><span class="p">(</span><span class="n">query_values</span><span class="p">)</span>
  <span class="n">signature</span> <span class="o">=</span> <span class="n">base64</span><span class="p">.</span><span class="n">urlsafe_b64encode</span><span class="p">(</span>
    <span class="n">hmac</span><span class="p">.</span><span class="n">new</span><span class="p">(</span><span class="n">secret_key</span><span class="p">.</span><span class="n">encode</span><span class="p">(),</span> <span class="n">message</span><span class="p">.</span><span class="n">encode</span><span class="p">(),</span> <span class="n">hashlib</span><span class="p">.</span><span class="n">sha256</span><span class="p">).</span><span class="n">digest</span><span class="p">()</span>
  <span class="p">).</span><span class="n">decode</span><span class="p">()</span>
  <span class="n">query_values</span><span class="p">[</span><span class="s">'signature'</span><span class="p">]</span> <span class="o">=</span> <span class="n">signature</span>
  <span class="n">message</span> <span class="o">=</span> <span class="n">urlencode</span><span class="p">(</span><span class="n">query_values</span><span class="p">)</span>
  <span class="n">uri</span> <span class="o">=</span> <span class="n">url</span> <span class="o">+</span> <span class="s">'?'</span> <span class="o">+</span> <span class="n">message</span>
  <span class="k">return</span> <span class="s">"&lt;a href='"</span> <span class="o">+</span> <span class="n">uri</span> <span class="o">+</span> <span class="s">"' class='electionbuddy-vote-button'&gt;Vote now&lt;/a&gt;"</span>
</code></pre></div><div class="highlight"><pre class="highlight php tab-php"><code><span class="cp">&lt;?</span>

<span class="c1">##### Example values:</span>

<span class="c1"># $eid = '12'</span>
<span class="c1"># $mid = 'jane@example.com'</span>
<span class="c1"># $secret_key = 'N+vlebJgl/Lkxtu2b4hOe+JUTpVm5arWGJbQ6U7BOFs='</span>
<span class="c1"># (Contact support to obtain `secret_key`)</span>

<span class="c1">#####</span>

<span class="k">function</span> <span class="n">generate_vote_anchor</span><span class="p">(</span><span class="nv">$secret_key</span><span class="p">,</span> <span class="nv">$eid</span><span class="p">,</span> <span class="nv">$mid</span><span class="p">)</span> <span class="p">{</span>
  <span class="nv">$url</span> <span class="o">=</span> <span class="s1">'https://secure.electionbuddy.com/integrations/v1/sso'</span><span class="p">;</span>

  <span class="nv">$query_values</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span>
    <span class="s1">'eid'</span> <span class="o">=&gt;</span> <span class="nv">$eid</span><span class="p">,</span>
    <span class="s1">'exp'</span> <span class="o">=&gt;</span> <span class="nb">time</span><span class="p">(),</span>
    <span class="s1">'mid'</span> <span class="o">=&gt;</span> <span class="nv">$mid</span>
  <span class="p">);</span>

  <span class="nv">$message</span> <span class="o">=</span> <span class="nb">http_build_query</span><span class="p">(</span><span class="nv">$query_values</span><span class="p">);</span>
  <span class="nv">$signature</span> <span class="o">=</span> <span class="nb">strtr</span><span class="p">(</span><span class="nb">base64_encode</span><span class="p">(</span><span class="nb">hash_hmac</span><span class="p">(</span><span class="s1">'sha256'</span><span class="p">,</span> <span class="nv">$message</span><span class="p">,</span> <span class="nv">$secret_key</span><span class="p">,</span> <span class="kc">true</span><span class="p">)),</span> <span class="s1">'+/'</span><span class="p">,</span> <span class="s1">'-_'</span><span class="p">);</span>
  <span class="nv">$query_values</span><span class="p">[</span><span class="s1">'signature'</span><span class="p">]</span> <span class="o">=</span> <span class="nv">$signature</span><span class="p">;</span>
  <span class="nv">$message</span> <span class="o">=</span> <span class="nb">http_build_query</span><span class="p">(</span><span class="nv">$query_values</span><span class="p">);</span>
  <span class="nv">$uri</span> <span class="o">=</span> <span class="nv">$url</span> <span class="mf">.</span> <span class="s1">'?'</span> <span class="mf">.</span> <span class="nv">$message</span><span class="p">;</span>

  <span class="k">return</span> <span class="p">(</span><span class="s2">"&lt;a href='"</span> <span class="mf">.</span> <span class="nv">$uri</span> <span class="mf">.</span> <span class="s2">"' class='electionbuddy-vote-button'&gt;Vote now&lt;/a&gt;"</span><span class="p">);</span>

<span class="p">}</span>
<span class="cp">?&gt;</span>
</code></pre></div>
<p>This endpoint authenticates a voting request for a particular user (for example, from your organization&#39;s internal dashboard). If the signature is valid and the voter (identified by <code>mid</code>) has yet to vote, they will be forwarded to a fresh ballot for the election <code>eid</code>.</p>
<h3 id='http-request-2'>HTTP Request</h3>
<p><code>GET https://secure.electionbuddy.com/integrations/v1/sso?{parameters}</code></p>
<h3 id='query-parameters-2'>Query Parameters</h3>
<table><thead>
<tr>
<th>Parameter</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>eid</td>
<td>Election ID: when editing your election, your election ID is the numeral that appears in the URL. (<code>1234</code> in <code>https://secure.electionbuddy.com/elections/1234/edit</code>)</td>
</tr>
<tr>
<td>exp</td>
<td>Request expiration date, in <a href="https://www.epochconverter.com/">Unix Epoch Time</a>. This time must be +/- 5 minutes from the time the request is received. If <code>exp</code> is older than 5 minutes, the voter will be directed to a &quot;Link Expired&quot; page.</td>
</tr>
<tr>
<td>mid</td>
<td>Member ID: A unique identifier for the member who is voting, such as an email address, or a membership ID, or a database primary key. This string can be anything that you can guarantee is unique for each of your voters. If a ballot attached to this member ID is already on your ElectionBuddy election voter list, this ballot will be shown to the authenticated voter. If there is no voter on your ElectionBuddy election voter list with this member ID, a fresh ballot will be created with an anonymized ballot ID.</td>
</tr>
<tr>
<td>signature</td>
<td>Generated signature using <code>secret_key</code>. See below.</td>
</tr>
</tbody></table>

<ul>
<li>All requests must be signed by <code>signature</code> <strong>appended</strong> (as the last parameter) to the query string, and generated from the formatted query string consisting of <code>eid</code>, <code>exp</code>, and <code>mid</code>.</li>
<li>Signatures must be generated using HMAC-SHA256 using the <code>secret_key</code> for your election in your <a href="https://secure.electionbuddy.com/accounts/secret">ElectionBuddy account</a>. Secret keys are unique to your <code>Election</code>.</li>
<li>All other parameters should appear <strong>alphabetically</strong> in the query string (i.e. <code>eid</code>, <code>exp</code>, <code>mid</code>).</li>
</ul>

<aside class="notice">
Remember - the query parameters must occur <strong>in order (alphabetically)</strong> as shown above, with the signature <strong>appended</strong> as the last parameter of the query string.
</aside>
<h1 id='errors'>Errors</h1>
<p>The ElectionBuddy SSO API returns the following error codes:</p>

<table><thead>
<tr>
<th>Error code</th>
<th>Meaning</th>
</tr>
</thead><tbody>
<tr>
<td>422</td>
<td>Unprocessable Entity -- Your request is valid but we were unable to create a ballot based on your request. This usually happens when your election has reached its maximum number of voters.</td>
</tr>
<tr>
<td>404</td>
<td>Not Found -- The election does not exist or is not authorized to use single sign on.</td>
</tr>
</tbody></table>
<h1 id='voter-status'>Voter Status</h1>
<blockquote>
<p>Below is an example request to obtain voter status:</p>
</blockquote>
<div class="highlight"><pre class="highlight ruby tab-ruby"><code><span class="nb">require</span> <span class="s1">'net/http'</span>
<span class="nb">require</span> <span class="s1">'addressable/uri'</span>
<span class="nb">require</span> <span class="s1">'base64'</span>
<span class="nb">require</span> <span class="s1">'openssl'</span>
<span class="nb">require</span> <span class="s1">'json'</span>

<span class="c1">##### Example values:</span>

<span class="c1"># eid = '12'</span>
<span class="c1"># mid = 'jane@example.com'</span>
<span class="c1"># secret_key = 'N+vlebJgl/Lkxtu2b4hOe+JUTpVm5arWGJbQ6U7BOFs='</span>
<span class="c1"># (Contact support to obtain `secret_key`)</span>

<span class="c1">#####</span>

<span class="k">def</span> <span class="nf">get_voter_status</span><span class="p">(</span><span class="n">secret_key</span><span class="p">,</span> <span class="n">eid</span><span class="p">,</span> <span class="n">mid</span><span class="p">)</span>
  <span class="n">url</span> <span class="o">=</span> <span class="s1">'https://secure.electionbuddy.com/sso'</span>
  <span class="n">headers</span> <span class="o">=</span> <span class="p">{</span> <span class="s1">'Accept'</span> <span class="o">=&gt;</span> <span class="s1">'application/json'</span> <span class="p">}</span>
  <span class="n">query_values</span> <span class="o">=</span> <span class="p">{</span>
    <span class="ss">eid: </span><span class="n">eid</span><span class="p">,</span>
    <span class="ss">exp: </span><span class="no">Time</span><span class="p">.</span><span class="nf">now</span><span class="p">.</span><span class="nf">to_i</span><span class="p">,</span>
    <span class="ss">mid: </span><span class="n">mid</span>
  <span class="p">}</span>

  <span class="n">uri</span> <span class="o">=</span> <span class="no">Addressable</span><span class="o">::</span><span class="no">URI</span><span class="p">.</span><span class="nf">parse</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
  <span class="n">uri</span><span class="p">.</span><span class="nf">query_values</span> <span class="o">=</span> <span class="n">query_values</span>
  <span class="n">message</span> <span class="o">=</span> <span class="n">uri</span><span class="p">.</span><span class="nf">query</span>
  <span class="n">signature</span> <span class="o">=</span> <span class="no">Base64</span><span class="p">.</span><span class="nf">urlsafe_encode64</span><span class="p">(</span>
    <span class="no">OpenSSL</span><span class="o">::</span><span class="no">HMAC</span><span class="p">.</span><span class="nf">digest</span><span class="p">(</span><span class="s1">'sha256'</span><span class="p">,</span> <span class="n">secret_key</span><span class="p">,</span> <span class="n">message</span><span class="p">)</span>
  <span class="p">)</span>
  <span class="n">uri</span><span class="p">.</span><span class="nf">query_values</span> <span class="o">=</span> <span class="n">query_values</span><span class="p">.</span><span class="nf">merge</span><span class="p">(</span><span class="ss">signature: </span><span class="n">signature</span><span class="p">)</span>

  <span class="n">net</span> <span class="o">=</span> <span class="no">Net</span><span class="o">::</span><span class="no">HTTP</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="n">uri</span><span class="p">.</span><span class="nf">host</span><span class="p">,</span> <span class="mi">443</span><span class="p">)</span>
  <span class="n">net</span><span class="p">.</span><span class="nf">use_ssl</span> <span class="o">=</span> <span class="kp">true</span>
  <span class="n">net</span><span class="p">.</span><span class="nf">verify_mode</span> <span class="o">=</span> <span class="no">OpenSSL</span><span class="o">::</span><span class="no">SSL</span><span class="o">::</span><span class="no">VERIFY_PEER</span>

  <span class="n">response</span> <span class="o">=</span> <span class="n">net</span><span class="p">.</span><span class="nf">post</span><span class="p">(</span><span class="n">uri</span><span class="p">.</span><span class="nf">path</span><span class="p">,</span> <span class="n">uri</span><span class="p">.</span><span class="nf">query</span><span class="p">,</span> <span class="n">headers</span><span class="p">)</span>
  <span class="no">JSON</span><span class="p">.</span><span class="nf">parse</span><span class="p">(</span><span class="n">response</span><span class="p">.</span><span class="nf">body</span><span class="p">)</span>
<span class="k">end</span>
</code></pre></div>
<p>The same endpoint can be used to obtain a voter&#39;s status. This can be used, for example, to send out your own custom vote reminders to those voters who have not yet voted.</p>

<p>Voter status requests use the same parameters as above, but will request a JSON response (header of: <code>Accept: application/json</code>).</p>
<h3 id='http-request'>HTTP Request</h3>
<p><code>GET https://secure.electionbuddy.com/sso?{parameters}</code> (Header: <code>Accept: application/json</code>)</p>

<table><thead>
<tr>
<th>HTTP Code</th>
<th>Response Body</th>
<th>Meaning</th>
</tr>
</thead><tbody>
<tr>
<td>200</td>
<td><code>{ &#39;voted&#39; : true, &#39;election_state&#39; : &#39;running&#39; }</code></td>
<td>The only valid election state for voting is <code>running</code>: all other states mean that either voting has not begun yet, or has ended.</td>
</tr>
</tbody></table>

      </div>
      <div class="dark-box">
          <div class="lang-selector">
                <a href="#" data-language-name="ruby">ruby</a>
                <a href="#" data-language-name="python">python</a>
                <a href="#" data-language-name="php">php</a>
          </div>
      </div>
    </div>
  </body>
</html>
